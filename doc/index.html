<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl">
  <title data-ice="title">API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="git+ssh://git@github.com/endlist/simple-limiter.git">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/RateLimiter.js~RateLimiter.html">RateLimiter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/TokenBucket.js~TokenBucket.html">TokenBucket</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><div data-ice="index" class="github-markdown"><h1 id="simple-limiter">simple-limiter</h1>
<p><a href="https://travis-ci.org/endlist/simple-limiter"><img src="https://travis-ci.org/endlist/simple-limiter.svg" alt="Build Status"></a></p>
<p><a href="http://endlist.github.io/simple-limiter/coverage/lcov-report/">Code Coverage Report</a><br><a href="http://endlist.github.io/simple-limiter/doc/">Documentation</a></p>
<p>simple synchronous library to limit rate by any key using the <a href="https://en.wikipedia.org/wiki/Token_bucket">token-bucket algorithm</a></p>
<p>made to work with <a href="http://github.com/autoric/super-router">super-router</a></p>
<h2 id="usage">Usage</h2>
<p>This is made to work with Super Router, but can work with any middleware.  Simple Limiter doesn&apos;t handle request headers or response for you, but it does return values to make setting the headers and body easy:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">const SuperRouter = require(&apos;super-router&apos;);
const RateLimiter = require(&apos;simple-limiter&apos;).RateLimiter;

module.exports = function() {
  const limiter = New RateLimiter({
    limit             : 20,
    incrementInterval : 5000,
    increment         : 1,
  });

  app.use({
    path    : &apos;/thispath&apos;,
    handler : (opts) =&gt; {
      const request = opts.request;
      const response = opts.response;
      const key = `${request.yourKey}`;
      const tokensRemaining = limiter.getTokensRemaining(key);

      response.setHeader(&apos;X-Rate-Limit-Limit&apos;, `${limiter.config.limit}`);
      response.setHeader(&apos;X-Rate-Limit-Remaining&apos;, `${tokensRemaining}`);

      limiter.decrementTokens(key, 5);
    },
  });
};</code>
</code></pre>
<p>If you change the default increment and decrement amounts to suit your project, which is recommended, you will run into situations where the user will have tokens remaining, but not enough to cover the cost of a request.</p>
<p>In this case, Simple Limiter throws a default error, which can be caught in middleware and served to the user as-is, or can be transformed to suit your project&apos;s standards:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">try {
  limiter.decrementTokens(ip);
}
catch (error) {
  response.setBody({
    id      : &apos;RateLimitError&apos;,
    code    : 429,
    message : &apos;Too Many Requests&apos;,
  });
}</code>
</code></pre>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
